<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>IViagem – Planejador de Viagens Inteligente</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary-green: #10b981;
      --primary-blue: #0ea5e9;
      --primary-dark: #0f172a;
      --primary-white: #f8fafc;
      --accent-green: #34d399;
      --accent-blue: #38bdf8;
      --text-primary: #f8fafc;
      --text-secondary: #cbd5e1;
      --border-color: #1e293b;
      --card-bg: #1a2332;
      --radius: 16px;
      --radius-lg: 24px;
    }

    html, body {
      height: 100%;
      width: 100%;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1a2f4a 50%, #0f172a 100%);
      color: var(--text-primary);
      overflow-x: hidden;
      background-size: 400% 400%;
      animation: gradientBackground 15s ease infinite;
    }

    @keyframes gradientBackground {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* ========================
       SPLASH SCREEN
       ======================== */
    .splash-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #0a5f6f 0%, #0f172a 50%, #1a2f4a 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      opacity: 1;
      animation: splashFadeOut 0.8s ease-in-out 2.5s forwards;
    }

    .splash-content {
      text-align: center;
      animation: splashBounceIn 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    .splash-logo {
      width: 120px;
      height: 120px;
      margin-bottom: 24px;
      animation: splashRotate 2s ease-in-out;
    }

    .splash-logo img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .splash-title {
      font-size: 32px;
      font-weight: 700;
      color: var(--primary-white);
      margin-bottom: 12px;
      animation: splashSlideUp 0.8s ease-out 0.2s backwards;
    }

    .splash-subtitle {
      font-size: 16px;
      color: var(--accent-green);
      font-weight: 500;
      animation: splashSlideUp 0.8s ease-out 0.4s backwards;
    }

    @keyframes splashFadeOut {
      0% { opacity: 1; visibility: visible; }
      100% { opacity: 0; visibility: hidden; }
    }

    @keyframes splashBounceIn {
      0% { transform: scale(0.3); opacity: 0; }
      50% { opacity: 1; }
      100% { transform: scale(1); opacity: 1; }
    }

    @keyframes splashRotate {
      0% { transform: rotate(0deg) scale(0.8); }
      50% { transform: rotate(180deg) scale(1); }
      100% { transform: rotate(360deg) scale(1); }
    }

    @keyframes splashSlideUp {
      0% { transform: translateY(30px); opacity: 0; }
      100% { transform: translateY(0); opacity: 1; }
    }

    /* ========================
       MAIN LAYOUT
       ======================== */
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 32px 20px;
      min-height: 100vh;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 40px;
      gap: 20px;
      flex-wrap: wrap;
      animation: slideDown 0.6s ease-out;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .logo-small {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--primary-green), var(--primary-blue));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      font-weight: 700;
      color: var(--primary-white);
      box-shadow: 0 8px 24px rgba(16, 185, 129, 0.3);
    }

    .title {
      font-size: clamp(24px, 4vw, 32px);
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent-green), var(--accent-blue));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .header-right {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .status-badge {
      padding: 8px 16px;
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid var(--primary-green);
      border-radius: 999px;
      font-size: 12px;
      color: var(--accent-green);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      background: var(--primary-green);
      border-radius: 50%;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* ========================
       FORM SECTION
       ======================== */
    .form-section {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 32px;
      margin-bottom: 32px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: slideUp 0.6s ease-out 0.1s backwards;
      backdrop-filter: blur(10px);
    }

    .form-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .form-title::before {
      content: '✈️';
      font-size: 24px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .form-label {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    input, select, textarea {
      padding: 12px 16px;
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      color: var(--text-primary);
      font-size: 14px;
      font-family: inherit;
      transition: all 0.3s ease;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary-green);
      background: rgba(15, 23, 42, 0.95);
      box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
    }

    textarea {
      resize: vertical;
      min-height: 100px;
    }

    .form-actions {
      display: flex;
      gap: 16px;
      align-items: center;
      flex-wrap: wrap;
      margin-top: 28px;
    }

    .btn {
      padding: 12px 28px;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      white-space: nowrap;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary-green), var(--primary-blue));
      color: var(--primary-dark);
      box-shadow: 0 8px 24px rgba(16, 185, 129, 0.3);
    }

    .btn-primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 12px 32px rgba(16, 185, 129, 0.4);
    }

    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: rgba(14, 165, 233, 0.1);
      color: var(--accent-blue);
      border: 1px solid var(--primary-blue);
    }

    .btn-secondary:hover {
      background: rgba(14, 165, 233, 0.2);
    }

    .spinner {
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-top-color: var(--primary-white);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .form-hint {
      font-size: 12px;
      color: var(--text-secondary);
      margin-top: 8px;
    }

    /* ========================
       RESULTS SECTION
       ======================== */

    .results-section {
      display: none;
      animation: slideUp 0.6s ease-out;
    }

    .results-section.show {
      display: block;
    }

    .results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 24px;
      margin-bottom: 32px;
    }

    .result-card {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 24px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
      animation: cardSlideUp 0.6s ease-out backwards;
    }

    .result-card:hover {
      transform: translateY(-4px);
      border-color: var(--primary-green);
      box-shadow: 0 24px 72px rgba(16, 185, 129, 0.2);
    }

    .result-card:nth-child(1) { animation-delay: 0s; }
    .result-card:nth-child(2) { animation-delay: 0.1s; }
    .result-card:nth-child(3) { animation-delay: 0.2s; }
    .result-card:nth-child(4) { animation-delay: 0.3s; }
    .result-card:nth-child(5) { animation-delay: 0.4s; }
    .result-card:nth-child(6) { animation-delay: 0.5s; }

    @keyframes cardSlideUp {
      0% { transform: translateY(30px); opacity: 0; }
      100% { transform: translateY(0); opacity: 1; }
    }

    @keyframes slideUp {
      0% { transform: translateY(20px); opacity: 0; }
      100% { transform: translateY(0); opacity: 1; }
    }

    @keyframes slideDown {
      0% { transform: translateY(-20px); opacity: 0; }
      100% { transform: translateY(0); opacity: 1; }
    }

    .result-card-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--accent-green);
    }

    .metric-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 12px;
      margin-bottom: 16px;
    }

    .metric {
      background: rgba(16, 185, 129, 0.05);
      border: 1px solid rgba(16, 185, 129, 0.2);
      border-radius: 12px;
      padding: 12px;
      text-align: center;
    }

    .metric-label {
      font-size: 11px;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 6px;
    }

    .metric-value {
      font-size: 20px;
      font-weight: 700;
      color: var(--accent-green);
    }

    .divider {
      height: 1px;
      background: var(--border-color);
      margin: 16px 0;
    }

    .text-content {
      font-size: 14px;
      line-height: 1.6;
      color: var(--text-secondary);
    }

    .text-content strong {
      color: var(--text-primary);
    }

    .list-items {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .list-items li {
      padding: 8px 12px;
      background: rgba(16, 185, 129, 0.05);
      border-left: 3px solid var(--primary-green);
      border-radius: 4px;
      font-size: 13px;
      color: var(--text-secondary);
    }

    .table-wrapper {
      overflow-x: auto;
      margin: 16px 0;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    th {
      background: rgba(16, 185, 129, 0.1);
      color: var(--accent-green);
      padding: 12px;
      text-align: left;
      font-weight: 600;
      border-bottom: 1px solid var(--border-color);
    }

    td {
      padding: 10px 12px;
      border-bottom: 1px solid var(--border-color);
      color: var(--text-secondary);
    }

    tr:hover {
      background: rgba(16, 185, 129, 0.05);
    }

    .itinerary-day {
      background: rgba(16, 185, 129, 0.05);
      border-left: 4px solid var(--primary-green);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
      transition: all 0.3s ease;
    }

    .itinerary-day:hover {
      transform: translateX(8px) scale(1.01);
      border-left-color: var(--accent-blue);
      box-shadow: 4px 4px 15px rgba(14, 165, 233, 0.1);
    }

    /* Adicionando transições e efeitos a outros elementos */
    .form-group input, .form-group select, .form-group textarea {
      transition: all 0.4s ease-in-out;
    }

    .form-group input:hover, .form-group select:hover, .form-group textarea:hover {
      border-color: var(--accent-green);
      box-shadow: 0 0 0 2px rgba(52, 211, 153, 0.2);
    }

    .btn {
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    .status-badge {
      transition: all 0.3s ease;
    }

    .status-badge:hover {
      transform: scale(1.05);
      box-shadow: 0 0 15px rgba(16, 185, 129, 0.4);
    }

    .metric {
      transition: all 0.3s ease;
    }

    .metric:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(16, 185, 129, 0.2);
    }

    .result-card-title {
      transition: color 0.3s ease;
    }

    .result-card-title:hover {
      color: var(--primary-blue);
    }

    .list-items li {
      transition: all 0.3s ease;
    }

    .list-items li:hover {
      background: rgba(56, 189, 248, 0.1);
      border-left-color: var(--primary-blue);
      transform: translateX(5px);
    }

    /* Efeito de brilho sutil ao redor dos cards */
    .result-card::before {
      content: "";
      position: absolute;
      top: -1px; left: -1px; right: -1px; bottom: -1px;
      background: linear-gradient(45deg, var(--primary-green), var(--primary-blue));
      z-index: -1;
      border-radius: var(--radius-lg);
      filter: blur(10px);
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
    }

    .result-card:hover::before {
      opacity: 0.3;
    }

    /* Animação para os títulos */
    .title, .form-title, .result-card-title {
      position: relative;
      overflow: hidden;
    }

     .title::after, .form-title::after, .result-card-title::after { content: "";
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 2px;
      background: linear-gradient(90deg, var(--primary-green), var(--primary-blue));
      transform: scaleX(0);
      transform-origin: left;
      transition: transform 0.4s ease-out;
    }

    .title:hover::after, .form-title:hover::after, .result-card-title:hover::after {
      transform: scaleX(1);
    }

    /* Animação para os ícones nos títulos */
    .form-title::before, .result-card-title::before {
      transition: transform 0.3s ease-out;
    }

    .form-title:hover::before, .result-card-title:hover::before {
      transform: rotate(10deg) scale(1.1);
    }

    /* Efeito de fundo sutil nos inputs */
    input, select, textarea {
      background-image: linear-gradient(to right, rgba(15, 23, 42, 0.8) 0%, rgba(26, 35, 50, 0.8) 100%);
      border: 1px solid rgba(30, 41, 59, 0.6);
    }

    input:focus, select:focus, textarea:focus {
      background-image: linear-gradient(to right, rgba(15, 23, 42, 0.95) 0%, rgba(26, 35, 50, 0.95) 100%);
      border-color: var(--primary-blue);
    }

    /* Animação de entrada para os elementos do formulário */
    .form-group {
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInSlideUp 0.6s ease-out forwards;
    }

    .form-group:nth-child(1) { animation-delay: 0.1s; }
    .form-group:nth-child(2) { animation-delay: 0.2s; }
    .form-group:nth-child(3) { animation-delay: 0.3s; }
    .form-group:nth-child(4) { animation-delay: 0.4s; }
    .form-group:nth-child(5) { animation-delay: 0.5s; }
    .form-group:nth-child(6) { animation-delay: 0.6s; }
    .form-group:nth-child(7) { animation-delay: 0.7s; }
    .form-group:nth-child(8) { animation-delay: 0.8s; }

    @keyframes fadeInSlideUp {
      0% { opacity: 0; transform: translateY(20px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    /* Ajuste para o botão de exportar PDF */
    #exportPdfBtn {
      background: var(--primary-blue);
      color: var(--primary-dark);
      box-shadow: 0 8px 24px rgba(14, 165, 233, 0.3);
    }

    #exportPdfBtn:hover {
      background: var(--accent-blue);
      box-shadow: 0 12px 32px rgba(14, 165, 233, 0.4);
    }

    /* Efeito de brilho no logo pequeno */
    .logo-small {
      position: relative;
      overflow: hidden;
    }

    .logo-small::before {
      content: "";
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: all 0.8s ease;
    }

    .logo-small:hover::before {
      left: 100%;
    }

    .logo-small:hover {
      transform: scale(1.1);
      box-shadow: 0 0 20px rgba(56, 189, 248, 0.5);
    }

    .title {
      transition: all 0.3s ease;
    }

    .title:hover {
      letter-spacing: 1px;
    }

    /* Animação para o status badge */
    .status-badge {
      position: relative;
      overflow: hidden;
    }

    .status-badge::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle, rgba(52, 211, 153, 0.3) 0%, transparent 70%);
      transform: scale(0);
      opacity: 0;
      transition: all 0.5s ease-out;
    }

    .status-badge:hover::before {
      transform: scale(1.5);
      opacity: 1;
    }

    .status-dot {
      animation: pulse 1.5s infinite alternate, glow 1.5s infinite alternate;
    }

    @keyframes glow {
      0%, 100% { box-shadow: 0 0 5px var(--primary-green), 0 0 10px var(--primary-green); }
      50% { box-shadow: 0 0 10px var(--primary-green), 0 0 20px var(--primary-green); }
    }

    /* Efeito de borda animada para os cards */
    .result-card {
      position: relative;
      overflow: hidden;
    }

    .result-card::after {
      content: "";
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      border: 2px solid transparent;
      border-radius: var(--radius-lg);
      background: linear-gradient(45deg, var(--primary-green), var(--primary-blue)) border-box;
      -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      animation: borderGlow 4s infinite linear;
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    .result-card:hover::after {
      opacity: 1;
    }

    @keyframes borderGlow {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Animação para o texto de observações gerais */
    #generalObservations p {
      opacity: 0;
      transform: translateY(10px);
      animation: fadeInText 0.5s ease-out forwards;
    }

    #generalObservations p:nth-child(1) { animation-delay: 0.1s; }
    #generalObservations p:nth-child(2) { animation-delay: 0.2s; }
    #generalObservations p:nth-child(3) { animation-delay: 0.3s; }

    @keyframes fadeInText {
      0% { opacity: 0; transform: translateY(10px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    /* Animação para as linhas da tabela */
    table tr {
      opacity: 0;
      transform: translateX(-10px);
      animation: fadeInRow 0.5s ease-out forwards;
    }

    table tr:nth-child(1) { animation-delay: 0.1s; }
    table tr:nth-child(2) { animation-delay: 0.2s; }
    table tr:nth-child(3) { animation-delay: 0.3s; }
    table tr:nth-child(4) { animation-delay: 0.4s; }

    @keyframes fadeInRow {
      0% { opacity: 0; transform: translateX(-10px); }
      100% { opacity: 1; transform: translateX(0); }
    }

    /* Animação para os itens da lista */
    .list-items li {
      opacity: 0;
      transform: translateX(10px);
      animation: fadeInListItem 0.5s ease-out forwards;
    }

    .list-items li:nth-child(1) { animation-delay: 0.1s; }
    .list-items li:nth-child(2) { animation-delay: 0.2s; }
    .list-items li:nth-child(3) { animation-delay: 0.3s; }

    @keyframes fadeInListItem {
      0% { opacity: 0; transform: translateX(10px); }
      100% { opacity: 1; transform: translateX(0); }
    }

    /* Animação para os dias do itinerário */
    .itinerary-day {
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInSlideUpDay 0.6s ease-out forwards;
    }

    .itinerary-day:nth-child(1) { animation-delay: 0.1s; }
    .itinerary-day:nth-child(2) { animation-delay: 0.2s; }
    .itinerary-day:nth-child(3) { animation-delay: 0.3s; }

    @keyframes fadeInSlideUpDay {
      0% { opacity: 0; transform: translateY(20px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    /* Efeito de fundo para o body */
    body {
      background-attachment: fixed;
      background-size: cover;
      background-position: center;
      animation: gradientShift 20s infinite alternate;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 0%; }
      100% { background-position: 100% 100%; }
    }


    @media (max-width: 768px) {
      .itinerary-day:hover {
        transform: translateX(4px);
      }
    }

    .day-date {
      font-weight: 700;
      color: var(--accent-green);
      font-size: 12px;
      text-transform: uppercase;
      margin-bottom: 8px;
    }

    .day-activity {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 6px;
      padding-left: 16px;
      position: relative;
    }

    .day-activity::before {
      content: '→';
      position: absolute;
      left: 0;
      color: var(--primary-green);
      font-weight: 700;
    }

    .day-cost {
      margin-top: 8px;
      padding-top: 8px;
      border-top: 1px solid rgba(16, 185, 129, 0.2);
      font-size: 12px;
      color: var(--accent-green);
      font-weight: 600;
    }

    .day-narrative {
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid rgba(16, 185, 129, 0.2);
      font-size: 13px;
      color: var(--text-secondary);
      font-style: italic;
    }

    /* ========================
       RESPONSIVE
       ======================== */
    @media (max-width: 768px) {
      .container {
        padding: 20px 16px;
      }

      header {
        flex-direction: column;
        align-items: flex-start;
        margin-bottom: 24px;
      }

      .form-section {
        padding: 20px;
      }

      .form-grid {
        grid-template-columns: 1fr;
      }

      .results-grid {
        grid-template-columns: 1fr;
      }

      .title {
        font-size: 24px;
      }
    }
    /* ========================
       ENHANCEMENTS FOR FUTURISTIC DESIGN AND ANIMATIONS
       ======================== */

    /* Particle Background Effect */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.1) 0%, transparent 30%),
                  radial-gradient(circle at bottom right, rgba(16, 185, 129, 0.1) 0%, transparent 30%);
      z-index: -1;
      animation: backgroundPulse 15s infinite alternate;
    }

    @keyframes backgroundPulse {
      0% { transform: scale(1); opacity: 0.8; }
      100% { transform: scale(1.1); opacity: 1; }
    }

    /* Input/Select/Textarea Focus Glow */
    input:focus, select:focus, textarea:focus {
      box-shadow: 0 0 0 4px var(--accent-blue), 0 0 15px var(--primary-blue);
      border-color: var(--accent-blue);
    }

    /* Button Hover Effects */
    .btn-primary:hover:not(:disabled) {
      background: linear-gradient(135deg, var(--accent-green), var(--accent-blue));
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 15px 35px rgba(16, 185, 129, 0.5);
    }

    .btn-secondary:hover {
      background: rgba(14, 165, 233, 0.3);
      border-color: var(--accent-blue);
      transform: translateY(-2px);
    }

    /* Card Hover Glow */
    .result-card:hover {
      border-color: var(--accent-blue);
      box-shadow: 0 24px 72px rgba(14, 165, 233, 0.2);
      transform: translateY(-8px) scale(1.01);
    }

    /* Itinerary Day Hover */
    .itinerary-day:hover {
      transform: translateX(8px) scale(1.01);
      border-left-color: var(--accent-blue);
      box-shadow: 4px 4px 15px rgba(14, 165, 233, 0.1);
    }

    /* Scrollbar Styling */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--primary-dark);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--primary-blue);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--accent-blue);
    }
    /* ======= PRINT THEME (uso no PDF) ======= */
.print-sheet {
  width: 800px;           /* base de layout */
  background: #ffffff;    /* fundo branco */
  color: #111827;         /* texto escuro */
  font-family: Arial, Helvetica, sans-serif;
  padding: 24px;
}
.print-sheet h1, .print-sheet h2, .print-sheet h3 {
  color: #0f172a;
}
.print-sheet .result-card,
.print-sheet .form-section,
.print-sheet .table-wrapper,
.print-sheet table {
  background: #ffffff !important;
  border-color: #e5e7eb !important;
  box-shadow: none !important;
}
.print-sheet .result-card-title { color: #0ea5e9 !important; }
.print-sheet .metric-value { color: #10b981 !important; }
.print-sheet .itinerary-day {
  background: #fafafa !important;
  border-left: 4px solid #10b981 !important;
  box-shadow: none !important;
  transform: none !important;
}
.print-sheet * {
  animation: none !important;
  transition: none !important;
  text-shadow: none !important;
  filter: none !important;
}

/* Tabelas mais legíveis no PDF */
.print-sheet table { width: 100%; border-collapse: collapse; font-size: 12px; }
.print-sheet th, .print-sheet td {
  border: 1px solid #e5e7eb; padding: 8px; color: #111827;
}
.print-sheet th { background: #f3f4f6; color: #0f172a; }

/* Quebras de página suaves */
.print-sheet .itinerary-day { page-break-inside: avoid; }
.print-sheet h2, .print-sheet h3, .print-section { page-break-after: avoid; }

    </style>
</head>
<body>
  <!-- SPLASH SCREEN -->
  <div class="splash-screen" id="splashScreen">
    <div class="splash-content">
      <div class="splash-logo">
        <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="globeGradient" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" style="stop-color:#38bdf8;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#10b981;stop-opacity:1" />
            </linearGradient>
          </defs>
          <!-- Globe -->
          <circle cx="100" cy="100" r="70" fill="url(#globeGradient)" stroke="#ffffff" stroke-width="3"/>
          <!-- Globe grid -->
          <circle cx="100" cy="100" r="70" fill="none" stroke="#ffffff" stroke-width="1" opacity="0.3"/>
          <path d="M 100 30 Q 100 100 100 170" stroke="#ffffff" stroke-width="1" opacity="0.3"/>
          <ellipse cx="100" cy="100" rx="70" ry="30" fill="none" stroke="#ffffff" stroke-width="1" opacity="0.3"/>
          <!-- Airplane -->
          <g transform="translate(130, 70)">
            <path d="M 0 0 L 15 -8 L 15 8 Z" fill="#ffffff"/>
            <rect x="5" y="-3" width="20" height="6" fill="#ffffff" opacity="0.7"/>
          </g>
        </svg>
      </div>
      <h1 class="splash-title">IViagem</h1>
      <p class="splash-subtitle">Smart Travel Planner</p>
    </div>
  </div>

  <!-- MAIN CONTENT -->
  <div class="container">
    <!-- HEADER -->
    <header>
      <div class="header-left">
        <div class="logo-small">✈️</div>
        <h1 class="title">IViagem</h1>
      </div>
      <div class="header-right">
        <div class="status-badge">
          <span class="status-dot"></span>
          API Conectada
        </div>
      </div>
    </header>

    <!-- FORM SECTION -->
    <section class="form-section">
      <h2 class="form-title">Planeje sua Viagem</h2>
      <form id="travelForm">
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Cidade de Origem</label>
            <input type="text" id="fromCity" name="fromCity" placeholder="São Paulo" value="São Paulo" required />
          </div>
          <div class="form-group">
            <label class="form-label">Cidade de Destino</label>
            <input type="text" id="toCity" name="toCity" placeholder="Manaus" value="Manaus" required />
          </div>
          <div class="form-group">
            <label class="form-label">Data de Partida</label>
            <input type="date" id="dateFrom" name="dateFrom" required />
          </div>
          <div class="form-group">
            <label class="form-label">Data de Retorno</label>
            <input type="date" id="dateTo" name="dateTo" required />
          </div>
          <div class="form-group">
            <label class="form-label">Número de Viajantes</label>
            <input type="number" id="travelers" name="travelers" min="1" value="1" required />
          </div>
          <div class="form-group">
            <label class="form-label">Perfil de Viagem</label>
            <select id="profile" name="profile" required>
              <option value="econômico">Econômico</option>
              <option value="equilibrado" selected>Equilibrado</option>
              <option value="premium">Premium</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Interesses e Preferências</label>
          <textarea id="interests" name="interests" placeholder="Ex: cultura, gastronomia, natureza, aventura...">cultura, gastronomia</textarea>
          <p class="form-hint">Separe seus interesses por vírgula para um planejamento mais personalizado</p>
        </div>

        <div class="form-group">
          <label class="form-label">Teto de Orçamento (Opcional)</label>
          <input type="number" id="budget" name="budget" min="0" step="0.01" placeholder="Ex: 5000" />
          <p class="form-hint">Deixe em branco para sem limite de orçamento</p>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn-primary" id="submitBtn">
            <span class="spinner" id="spinner" style="display: none;"></span>
            <span id="btnLabel">Gerar Roteiro Inteligente</span>
          </button>
          <button type="button" class="btn btn-secondary" id="exportPdfBtn">
            Exportar PDF
          </button>
          <button type="button" class="btn btn-secondary" id="testApiBtn">
            Testar API
          </button>
        </div>
      </form>
    </section>

    <!-- RESULTS SECTION -->
    <section class="results-section" id="resultsSection">
      <!-- Summary Card -->
      <div class="results-grid">
        <div class="result-card">
          <h3 class="result-card-title">📊 Resumo Executivo</h3>
          <div class="metric-grid">
            <div class="metric">
              <div class="metric-label">Orçamento Total</div>
              <div class="metric-value" id="totalBudget">R$ 0</div>
            </div>
            <div class="metric">
              <div class="metric-label">Duração</div>
              <div class="metric-value" id="tripDuration">0 dias</div>
            </div>
            <div class="metric">
              <div class="metric-label">Risco Climático</div>
              <div class="metric-value" id="climateRisk" style="font-size: 14px;">—</div>
            </div>
          </div>
          <div class="divider"></div>
          <div class="text-content" id="generalObservations"></div>
        </div>

        <!-- Logistics Card -->
        <div class="result-card">
          <h3 class="result-card-title">🚀 Logística</h3>
          <div class="table-wrapper">
            <table id="legsTable"></table>
          </div>
          <div class="divider"></div>
          <div class="metric-grid">
            <div class="metric">
              <div class="metric-label">Tempo Total</div>
              <div class="metric-value" id="totalTime">—</div>
            </div>
            <div class="metric">
              <div class="metric-label">Distância</div>
              <div class="metric-value" id="totalDistance">—</div>
            </div>
          </div>
        </div>

        <!-- Budget Card -->
        <div class="result-card">
          <h3 class="result-card-title">💰 Orçamento Detalhado</h3>
          <div class="table-wrapper">
            <table id="costsTable"></table>
          </div>
        </div>
      </div>

      <!-- Itinerary Card (Full Width) -->
      <div class="result-card">
        <h3 class="result-card-title">📅 Itinerário Dia a Dia</h3>
        <div id="itineraryContainer"></div>
      </div>

      <!-- Suggestions Card (if any) -->
      <div class="result-card" id="suggestionsCard" style="display: none;">
        <h3 class="result-card-title">💡 Sugestões Personalizadas</h3>
        <ul class="list-items" id="suggestionsList"></ul>
      </div>

      <!-- Adjustments Card (if any) -->
      <div class="result-card" id="adjustmentsCard" style="display: none;">
        <h3 class="result-card-title">⚙️ Ajustes Aplicados</h3>
        <ul class="list-items" id="adjustmentsList"></ul>
      </div>

      <!-- Debug JSON (Hidden by default) -->
      <div class="result-card" style="display: none;">
        <h3 class="result-card-title">🔧 JSON (Debug)</h3>
        <pre class="text-content" id="jsonDebug" style="overflow-x: auto; background: rgba(0,0,0,0.2); padding: 12px; border-radius: 8px; font-size: 11px;"></pre>
      </div>
    </section>
  </div>

  <script>
    // ========================
    // UTILITY FUNCTIONS
    // ========================
 // ========================
  // UTILITY FUNCTIONS
  // ========================
  const $ = (sel) => document.querySelector(sel);
  const $$ = (sel) => Array.from(document.querySelectorAll(sel));
  const stripEmoji = (s) => s.replace(/[\p{Emoji_Presentation}\p{Emoji}\uFE0F]/gu, "").trim();

  async function addTTF(doc, name, style, url) {
    try {
      const rsp = await fetch(url, { cache: "force-cache" });
      if (!rsp.ok) throw new Error("Font fetch failed");
      const buf = await rsp.arrayBuffer();
      const bin = new Uint8Array(buf);
      let b64 = "";
      for (let i = 0; i < bin.length; i++) b64 += String.fromCharCode(bin[i]);
      doc.addFileToVFS(`${name}-${style}.ttf`, btoa(b64));
      doc.addFont(`${name}-${style}.ttf`, name, style);
      console.log(`✅ Fonte ${name}-${style} carregada`);
      return true;
    } catch (err) {
      console.warn(`⚠️ Falha ao carregar fonte ${name}:`, err);
      return false;
    }
  }

  async function ensureFont(doc) {
    const ok1 = await addTTF(
      doc,
      "Roboto",
      "normal",
      "https://cdn.jsdelivr.net/npm/@fontsource/roboto/files/roboto-latin-400-normal.ttf"
    );
    const ok2 = await addTTF(
      doc,
      "Roboto",
      "bold",
      "https://cdn.jsdelivr.net/npm/@fontsource/roboto/files/roboto-latin-700-normal.ttf"
    );
    if (ok1 && ok2) {
      doc.setFont("Roboto", "normal");
    } else {
      doc.setFont("helvetica", "normal");
      console.warn("⚙️ Usando Helvetica (fallback)");
    }
  }

  function formatCurrency(value) {
    return new Intl.NumberFormat('pt-BR', {
      style: 'currency',
      currency: 'BRL'
    }).format(value);
    }

    function formatDate(dateStr) {
      const date = new Date(dateStr + 'T00:00:00');
      return date.toLocaleDateString('pt-BR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
    }

    // ========================
    // INITIALIZATION
    // ========================
    function initializeDates() {
      const today = new Date();
      const plus7 = new Date(today);
      plus7.setDate(plus7.getDate() + 7);

      $('#dateFrom').valueAsDate = today;
      $('#dateTo').valueAsDate = plus7;
    }

    // ========================
    // API INTERACTION
    // ========================
    async function testAPI() {
      const apiUrl = 'http://127.0.0.1:8000/health';
      try {
        const response = await fetch(apiUrl);
        if (response.ok) {
          alert('✅ API conectada com sucesso!');
        } else {
          alert('❌ Erro ao conectar com a API. Status: ' + response.status);
        }
      } catch (error) {
        alert('❌ Erro de rede ao conectar com a API: ' + error.message);
      }
    }

    async function generateTravelPlan(formData) {
      const apiUrl = 'http://127.0.0.1:8000/plan';
;
      try {
        const response = await fetch(apiUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData),
        });

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.detail || 'Erro ao gerar roteiro de viagem.');
        }

        return await response.json();
      } catch (error) {
        console.error('Erro na API:', error);
        alert('Erro ao gerar roteiro: ' + error.message);
        return null;
      }
    }

    // ========================
    // UI RENDERING
    // ========================
    function renderResults(data) {
  if (!data) {
    $('#resultsSection').classList.remove('show');
    return;
  }

  // Summary
  $('#totalBudget').textContent = formatCurrency(data.orcamento_estimado_total || 0);
  const durationDays = Array.isArray(data.roteiro) ? data.roteiro.length : 0;
  $('#tripDuration').textContent = `${durationDays} dias`;
  $('#climateRisk').textContent = data.risco_climatico || '—';
  $('#generalObservations').innerHTML = data.observacoes_gerais
    ? `<p>${data.observacoes_gerais}</p>`
    : '';

  // Logistics
  const legs = Array.isArray(data.legs) ? data.legs : [];
  const legsTableBody = `
    <thead>
      <tr>
        <th>Origem</th>
        <th>Destino</th>
        <th>Transporte</th>
        <th>Duração</th>
        <th>Distância</th>
        <th>Custo</th>
      </tr>
    </thead>
    <tbody>
      ${legs.map(leg => `
        <tr>
          <td>${leg.origem}</td>
          <td>${leg.destino}</td>
          <td>${leg.modo}</td>
          <td>${(leg.duracao_h ?? 0).toFixed(1)} h</td>
          <td>${(leg.distancia_km ?? 0).toFixed(0)} km</td>
          <td>${formatCurrency(leg.preco_estimado ?? 0)}</td>
        </tr>
      `).join('')}
    </tbody>`;
  $('#legsTable').innerHTML = legsTableBody;

  // Totais logísticos
  const totalTimeH = legs.reduce((acc, l) => acc + (l.duracao_h || 0), 0);
  const totalDistKm = legs.reduce((acc, l) => acc + (l.distancia_km || 0), 0);
  $('#totalTime').textContent = data.tempo_voo_total || `${totalTimeH.toFixed(1)} h`;
  $('#totalDistance').textContent = `${totalDistKm.toFixed(0)} km`;

  // Budget table
  const items = Array.isArray(data.custos_itens) ? data.custos_itens : [];
  const costsTableBody = `
    <thead>
      <tr>
        <th>Categoria</th>
        <th>Descrição</th>
        <th>Qtd</th>
        <th>Unitário</th>
        <th>Total</th>
      </tr>
    </thead>
    <tbody>
      ${items.map(it => `
        <tr>
          <td>${it.categoria}</td>
          <td>${it.descricao}</td>
          <td>${it.quantidade}</td>
          <td>${formatCurrency(it.preco_unitario || 0)}</td>
          <td><strong>${formatCurrency(it.custo_total || 0)}</strong></td>
        </tr>
      `).join('')}
    </tbody>`;
  $('#costsTable').innerHTML = costsTableBody;

  // Itinerary
  const itinerary = Array.isArray(data.roteiro) ? data.roteiro : [];
  const itineraryHtml = itinerary.map(day => `
    <div class="itinerary-day">
      <div class="day-date">${formatDate(day.data)}</div>
      <p class="day-activity"><strong>Manhã:</strong> ${day.manha || '—'}</p>
      <p class="day-activity"><strong>Tarde:</strong> ${day.tarde || '—'}</p>
      <p class="day-activity"><strong>Noite:</strong> ${day.noite || '—'}</p>
      <div class="day-cost">Custo Estimado do Dia: ${formatCurrency(day.custo_estimado_dia || 0)}</div>
      ${day.narrativa ? `<p class="day-narrative">${day.narrativa}</p>` : ''}
    </div>
  `).join('');
  $('#itineraryContainer').innerHTML = itineraryHtml;

  // Suggestions
  if (Array.isArray(data.sugestoes) && data.sugestoes.length) {
    $('#suggestionsCard').style.display = 'block';
    $('#suggestionsList').innerHTML = data.sugestoes.map(s => `<li>${s}</li>`).join('');
  } else {
    $('#suggestionsCard').style.display = 'none';
  }

  // Adjustments
  if (Array.isArray(data.ajustes_aplicados) && data.ajustes_aplicados.length) {
    $('#adjustmentsCard').style.display = 'block';
    $('#adjustmentsList').innerHTML = data.ajustes_aplicados.map(a => `<li>${a}</li>`).join('');
  } else {
    $('#adjustmentsCard').style.display = 'none';
  }

  $('#resultsSection').classList.add('show');
}


    // ========================
    // EVENT HANDLERS
    // ========================
    document.addEventListener('DOMContentLoaded', () => {
      initializeDates();

      // Hide splash screen after animation
      const splashScreen = $('#splashScreen');
      splashScreen.addEventListener('animationend', () => {
        if (event.animationName === 'splashFadeOut') {
          splashScreen.style.display = 'none';
        }
      });

      $('#travelForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const submitBtn = $('#submitBtn');
        const spinner = $('#spinner');
        const btnLabel = $('#btnLabel');

        submitBtn.disabled = true;
        spinner.style.display = 'inline-block';
        btnLabel.textContent = 'Gerando...';

        const formData = {
        cidade_origem: $('#fromCity').value.trim(),
        destino: $('#toCity').value.trim(),
        data_inicio: $('#dateFrom').value,
        data_fim: $('#dateTo').value,
        numero_viajantes: parseInt($('#travelers').value, 10),
        perfil: $('#profile').value,
        temas: $('#interests').value.split(',').map(s => s.trim()).filter(Boolean),
        teto_orcamento: $('#budget').value ? parseFloat($('#budget').value) : 0,
        moeda: 'BRL'
      };


        const result = await generateTravelPlan(formData);
        renderResults(result);

        submitBtn.disabled = false;
        spinner.style.display = 'none';
        btnLabel.textContent = 'Gerar Roteiro Inteligente';
      });

      $("#testApiBtn").addEventListener("click", testAPI);

       $("#exportPdfBtn").addEventListener("click", async () => {
      const resultsSection = $("#resultsSection");
      if (!resultsSection.classList.contains("show")) {
        alert("Por favor, gere um roteiro primeiro para exportar.");
        return;
      }

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ unit: "pt", format: "a4", putOnlyUsedFonts: true, compress: true });

      // 1) Fonte Unicode (Roboto) — Regular e Bold
      // (CDNs confiáveis; pode trocar por Inter/DejaVu se preferir)
      await addTTF(doc, "Roboto", "normal", "https://cdn.jsdelivr.net/npm/@fontsource/roboto/files/roboto-latin-400-normal.ttf");
      await addTTF(doc, "Roboto", "bold",   "https://cdn.jsdelivr.net/npm/@fontsource/roboto/files/roboto-latin-700-normal.ttf");
      doc.setFont("Roboto", "normal");

      const margin = 40;
      const pageW = doc.internal.pageSize.getWidth();
      const pageH = doc.internal.pageSize.getHeight();

      const addHeaderFooter = (pageNumber, pageCount) => {
        doc.setFont("Roboto", "normal");
        doc.setFontSize(9);
        doc.setTextColor("#6b7280");
        doc.text("IViagem — Planejador de Viagens Inteligente", margin, 26);
        doc.setDrawColor("#e5e7eb");
        doc.line(margin, 30, pageW - margin, 30);

        doc.line(margin, pageH - 30, pageW - margin, pageH - 30);
        doc.text(`Página ${pageNumber} de ${pageCount}`, pageW - margin - 70, pageH - 16);
        doc.text(`Gerado em: ${new Date().toLocaleDateString("pt-BR")}`, margin, pageH - 16);
      };

      let cursorY = margin + 10;

      // 2) Título
      doc.setFont("Roboto", "bold");
      doc.setFontSize(20);
      doc.setTextColor("#0f172a");
      doc.text(stripEmoji("Roteiro de Viagem Inteligente"), pageW / 2, cursorY, { align: "center" });
      cursorY += 24;

      // 3) Resumo
      const resumo = [
        `Orçamento Total: ${$("#totalBudget").textContent}`,
        `Duração: ${$("#tripDuration").textContent}`,
        `Risco Climático: ${$("#climateRisk").textContent}`
      ];
      doc.setFont("Roboto", "bold");
      doc.setFontSize(13);
      doc.setTextColor("#111827");
      doc.text(stripEmoji("Resumo Executivo"), margin, cursorY);
      cursorY += 16;

      doc.setFont("Roboto", "normal");
      doc.setFontSize(11);
      doc.setTextColor("#111827");
      resumo.forEach(line => { doc.text(line, margin, cursorY); cursorY += 14; });

      const obs = $("#generalObservations")?.innerText?.trim();
      if (obs) {
        const wrapped = doc.splitTextToSize(obs, pageW - margin * 2);
        doc.setTextColor("#374151");
        wrapped.forEach(line => {
          if (cursorY > pageH - 60) { doc.addPage(); cursorY = margin + 10; }
          doc.text(line, margin, cursorY);
          cursorY += 14;
        });
        cursorY += 6;
      }

      // 4) Tabela Logística (legs)
      const legsTable = $("#legsTable");
      if (legsTable && legsTable.querySelectorAll("tbody tr").length) {
        if (cursorY > pageH - 120) { doc.addPage(); cursorY = margin + 10; }
        doc.setFont("Roboto", "bold"); doc.setFontSize(13); doc.setTextColor("#111827");
        doc.text(stripEmoji("Logística"), margin, cursorY);
        cursorY += 12;

        const headers = Array.from(legsTable.querySelectorAll("thead th")).map(th => stripEmoji(th.textContent.trim()));
        const body = Array.from(legsTable.querySelectorAll("tbody tr")).map(tr =>
          Array.from(tr.children).map(td => td.textContent.trim())
        );

        doc.autoTable({
          startY: cursorY,
          head: [headers],
          body,
          margin: { left: margin, right: margin },
          styles: { font: "Roboto", fontSize: 9, cellPadding: 5, overflow: "linebreak", textColor: "#111827" },
          headStyles: { fillColor: [14,165,233], textColor: 255, fontStyle: "bold" },
          columnStyles: {
            0: { cellWidth: 110 }, // origem
            1: { cellWidth: 110 }, // destino
            2: { cellWidth: 70 },  // transporte
            3: { cellWidth: 60, halign: "right" }, // duração
            4: { cellWidth: 60, halign: "right" }, // distância
            5: { cellWidth: 70, halign: "right" }, // custo (evita quebra "R$ 94 0,11")
          },
          didDrawPage: (data) => {
            const { pageNumber } = doc.internal.getCurrentPageInfo();
            const pageCount = doc.internal.getNumberOfPages();
            addHeaderFooter(pageNumber, pageCount);
          }
        });
        cursorY = doc.lastAutoTable.finalY + 10;

        // Totais
        doc.setFont("Roboto", "normal"); doc.setFontSize(11); doc.setTextColor("#111827");
        doc.text(`Tempo Total: ${$('#totalTime').textContent}`, margin, cursorY);
        doc.text(`Distância: ${$('#totalDistance').textContent}`, margin + 220, cursorY);
        cursorY += 18;
      }

      // 5) Tabela Orçamento
      const costsTable = $("#costsTable");
      if (costsTable && costsTable.querySelectorAll("tbody tr").length) {
        if (cursorY > pageH - 120) { doc.addPage(); cursorY = margin + 10; }
        doc.setFont("Roboto", "bold"); doc.setFontSize(13); doc.setTextColor("#111827");
        doc.text(stripEmoji("Orçamento Detalhado"), margin, cursorY);
        cursorY += 12;

        const headers = Array.from(costsTable.querySelectorAll("thead th")).map(th => stripEmoji(th.textContent.trim()));
        const body = Array.from(costsTable.querySelectorAll("tbody tr")).map(tr =>
          Array.from(tr.children).map((td, idx) => {
            const v = td.textContent.trim();
            // força alinhamento à direita pra Unitário/Total
            return (idx >= 3) ? v.replace(/\s+/g, " ") : v;
          })
        );

        doc.autoTable({
          startY: cursorY,
          head: [headers],
          body,
          margin: { left: margin, right: margin },
          styles: { font: "Roboto", fontSize: 9, cellPadding: 5, overflow: "linebreak", textColor: "#111827" },
          headStyles: { fillColor: [16,185,129], textColor: 255, fontStyle: "bold" },
          columnStyles: {
            0: { cellWidth: 110 },      // categoria
            1: { cellWidth: 190 },      // descrição
            2: { cellWidth: 40, halign: "right" }, // qtd
            3: { cellWidth: 70, halign: "right" }, // unitário
            4: { cellWidth: 70, halign: "right" }, // total
          },
          didDrawPage: (data) => {
            const { pageNumber } = doc.internal.getCurrentPageInfo();
            const pageCount = doc.internal.getNumberOfPages();
            addHeaderFooter(pageNumber, pageCount);
          }
        });
        cursorY = doc.lastAutoTable.finalY + 10;
      }

      // 6) Itinerário (estilizado com cartões e chips)
      const days = $$(".itinerary-day");
      if (days.length) {
        // Paleta e helpers
        const COLORS = {
          title:  "#0f172a",
          text:   "#1f2937",
          mute:   "#6b7280",
          line:   "#e5e7eb",
          chipM:  "#22c55e", // manhã
          chipT:  "#0ea5e9", // tarde
          chipN:  "#a78bfa", // noite
          cost:   "#10b981",
          band:   "#f3f4f6",
          card:   "#ffffff",
          narBg:  "#f9fafb",
          narBr:  "#e5e7eb",
        };

        const L = { pad: 16, gap: 10, lh: 13, h2: 14, chipH: 18, chipPadX: 8, chipRad: 8 };

        function ensureSpace(h) {
          if (cursorY + h > pageH - 40) {
            doc.addPage(); cursorY = margin + 10;
          }
        }
        function wrap(txt, w) { return doc.splitTextToSize(txt, w); }
        function textHeight(lines) { return (Array.isArray(lines) ? lines.length : 1) * (L.lh + 1); }

        function chip(x, y, txt, fill, txtColor="#ffffff") {
          const w = doc.getTextWidth(txt) + L.chipPadX * 2;
          doc.setFillColor(fill); doc.roundedRect(x, y - L.chipH + 4, w, L.chipH, L.chipRad, L.chipRad, "F");
          doc.setTextColor(txtColor); doc.setFontSize(10);
          doc.text(txt, x + L.chipPadX, y - 4);
          return w;
        }

        function iconLine(x, y, ico, label, content, color) {
          doc.setFontSize(11); doc.setTextColor(COLORS.text);
          // ícone
          doc.setTextColor(color);
          doc.text(ico, x, y);
          // rótulo
          doc.setTextColor(COLORS.mute);
          doc.setFont(undefined, "bold");
          doc.text(label, x + 14, y);
          // conteúdo
          doc.setFont(undefined, "normal"); doc.setTextColor(COLORS.text);
          const maxW = pageW - margin - (x + 14);
          const lines = wrap(content, maxW);
          doc.text(lines, x + 14, y + 14);
          return 14 + textHeight(lines);
        }

        // Título da seção
        if (cursorY > pageH - 120) { doc.addPage(); cursorY = margin + 10; }
        doc.setFont("Roboto", "bold"); doc.setFontSize(13); doc.setTextColor(COLORS.title);
        doc.text("Itinerário Dia a Dia", margin, cursorY);
        cursorY += 12;

        for (let idx = 0; idx < days.length; idx++) {
          const day = days[idx];
          const date   = day.querySelector(".day-date")?.textContent?.trim() || "";
          const manha  = (day.querySelectorAll(".day-activity")[0]?.textContent || "").replace(/^Manhã:\s*/,"").trim() || "—";
          const tarde  = (day.querySelectorAll(".day-activity")[1]?.textContent || "").replace(/^Tarde:\s*/,"").trim() || "—";
          const noite  = (day.querySelectorAll(".day-activity")[2]?.textContent || "").replace(/^Noite:\s*/,"").trim() || "—";
          const cost   = day.querySelector(".day-cost")?.textContent?.replace("Custo Estimado do Dia:","").trim() || "";
          const narr   = day.querySelector(".day-narrative")?.textContent?.trim() || "";

          // Pré-cálculo de altura para quebras de página
          const manhH = 20 + textHeight(wrap(manha, pageW - margin*2 - 40));
          const tardH = 20 + textHeight(wrap(tarde, pageW - margin*2 - 40));
          const noitH = 20 + textHeight(wrap(noite, pageW - margin*2 - 40));
          const narrLines = narr ? wrap(`“${narr}”`, pageW - margin*2 - 24) : [];
          const narrH = narr ? 16 + textHeight(narrLines) + 12 : 0;
          const headerH = 34;
          const cardH = L.pad + headerH + L.gap + manhH + L.gap + tardH + L.gap + noitH + (narr ? (L.gap + narrH) : 0) + L.pad;

          ensureSpace(cardH);

          // CARTÃO
          // corpo
          doc.setDrawColor(COLORS.line);
          doc.setFillColor(COLORS.card);
          doc.roundedRect(margin, cursorY, pageW - margin*2, cardH, 8, 8, "FD");

          // faixa do cabeçalho
          doc.setFillColor(COLORS.band);
          doc.roundedRect(margin, cursorY, pageW - margin*2, headerH, 8, 8, "F");

          // data e "Dia X"
          doc.setTextColor(COLORS.title);
          doc.setFont("Roboto", "bold"); doc.setFontSize(12);
          doc.text(date, margin + L.pad, cursorY + 22);
          const diaTxt = `Dia ${idx + 1}`;
          doc.setFont("Roboto", "normal"); doc.setFontSize(10);
          const diaW = doc.getTextWidth(diaTxt) + 14;
          doc.setFillColor("#e2e8f0");
          doc.roundedRect(pageW - margin - L.pad - diaW, cursorY + 8, diaW, 18, 9, 9, "F");
          doc.setTextColor("#334155");
          doc.text(diaTxt, pageW - margin - L.pad - diaW + 7, cursorY + 21);

          // custo à direita (chip verde)
          if (cost) {
            const c = `Custo: ${cost}`;
            const w = doc.getTextWidth(c) + 16;
            doc.setFillColor(COLORS.cost);
            doc.roundedRect(pageW - margin - L.pad - diaW - 8 - w, cursorY + 8, w, 18, 9, 9, "F");
            doc.setTextColor("#ffffff"); doc.setFontSize(10);
            doc.text(c, pageW - margin - L.pad - diaW - 8 - w + 8, cursorY + 21);
          }

          // conteúdo interno
          let y = cursorY + headerH + L.pad;

          // chips período
          const x0 = margin + L.pad;
          const cm = chip(x0, y, "Manhã",  COLORS.chipM);
          const ct = chip(x0 + cm + 8, y, "Tarde",  COLORS.chipT);
          const cn = chip(x0 + cm + 8 + ct + 8, y, "Noite",  COLORS.chipN);
          y += 18 + 6;

          // linhas com ícone + texto
          y += iconLine(x0, y, "☀️", "Manhã:",  manha, COLORS.chipM);
          y += L.gap;
          y += iconLine(x0, y, "🌤️", "Tarde:",  tarde, COLORS.chipT);
          y += L.gap;
          y += iconLine(x0, y, "🌙", "Noite:",  noite, COLORS.chipN);

          // narrativa (opcional) em box
          if (narr) {
            y += L.gap;
            const boxH = narrH;
            doc.setFillColor(COLORS.narBg);
            doc.setDrawColor(COLORS.narBr);
            doc.roundedRect(margin + L.pad, y, pageW - margin*2 - L.pad*2, boxH, 6, 6, "FD");
            doc.setTextColor(COLORS.mute);
            doc.setFont("Roboto", "italic"); doc.setFontSize(11);
            doc.text(narrLines, margin + L.pad + 12, y + 16);
            doc.setFont("Roboto", "normal");
          }

          cursorY += cardH + 10;
        }
      }


      // 7) Sugestões/Ajustes (se existirem)
      const sugLis = Array.from($("#suggestionsCard .list-items li") || []).map(li => li.textContent.trim());
      const adjLis = Array.from($("#adjustmentsCard .list-items li") || []).map(li => li.textContent.trim());

      if (sugLis.length) {
        if (cursorY > pageH - 120) { doc.addPage(); cursorY = margin + 10; }
        doc.setFont("Roboto", "bold"); doc.setFontSize(13); doc.setTextColor("#111827");
        doc.text(stripEmoji("Sugestões Personalizadas"), margin, cursorY);
        cursorY += 12;
        doc.setFont("Roboto", "normal"); doc.setFontSize(11);
        for (const s of sugLis) {
          const wrapped = doc.splitTextToSize(s, pageW - margin * 2);
          for (const w of wrapped) {
            if (cursorY > pageH - 60) { doc.addPage(); cursorY = margin + 10; }
            doc.text(stripEmoji(`- ${w}`), margin, cursorY);
            cursorY += 14;
          }
        }
      }

      if (adjLis.length) {
        if (cursorY > pageH - 120) { doc.addPage(); cursorY = margin + 10; }
        doc.setFont("Roboto", "bold"); doc.setFontSize(13); doc.setTextColor("#111827");
        doc.text(stripEmoji("Ajustes Aplicados"), margin, cursorY);
        cursorY += 12;
        doc.setFont("Roboto", "normal"); doc.setFontSize(11);
        for (const s of adjLis) {
          const wrapped = doc.splitTextToSize(s, pageW - margin * 2);
          for (const w of wrapped) {
            if (cursorY > pageH - 60) { doc.addPage(); cursorY = margin + 10; }
            doc.text(stripEmoji(`- ${w}`), margin, cursorY);
            cursorY += 14;
          }
        }
      }

      // Header/Footer em todas as páginas (chamada final para setar a contagem correta)
      const total = doc.internal.getNumberOfPages();
      for (let i = 1; i <= total; i++) {
        doc.setPage(i);
        addHeaderFooter(i, total);
      }

      doc.save("roteiro-de-viagem.pdf");
    });
    });
  </script>
</body>
</html>

